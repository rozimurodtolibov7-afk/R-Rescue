<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Rescue: Deep Sea</title>
    <style>
        body { margin: 0; background: #001219; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
        canvas { background: linear-gradient(to bottom, #005f73, #001219); box-shadow: 0 0 50px #000 inset; }
        #hud { position: absolute; top: 10px; width: 90%; display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; pointer-events: none; }
        .bar { width: 100px; height: 10px; background: #333; border-radius: 5px; overflow: hidden; display: inline-block; }
        #oxygen-level { height: 100%; background: #00f3ff; width: 100%; transition: 0.3s; }
        .controls { position: absolute; bottom: 30px; display: grid; grid-template-columns: repeat(3, 70px); gap: 15px; }
        .btn { width: 70px; height: 70px; background: rgba(255,255,255,0.1); border: 2px solid #00f3ff; color: #00f3ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; user-select: none; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="hud">
        <div>SCORE: <span id="score">0</span></div>
        <div>OXYGEN: <div class="bar"><div id="oxygen-level"></div></div></div>
    </div>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <div style="grid-column: 2" class="btn" onpointerdown="move('U')" onpointerup="stop()">▲</div>
        <div style="grid-column: 1" class="btn" onpointerdown="move('L')" onpointerup="stop()">◀</div>
        <div style="grid-column: 2" class="btn" onpointerdown="move('D')" onpointerup="stop()">▼</div>
        <div style="grid-column: 3" class="btn" onpointerdown="move('R')" onpointerup="stop()">▶</div>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const oxEl = document.getElementById('oxygen-level');

canvas.width = 400; canvas.height = 500;

let score = 0, oxygen = 100, gameActive = true, musicStarted = false;
const sub = { x: 200, y: 100, w: 40, h: 25, vx: 0, vy: 0 };
let divers = [], enemies = [];

// Musiqa generatori (Deep Sea Ambient)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playDeepMusic() {
    if (musicStarted) return; musicStarted = true;
    setInterval(() => {
        if(!gameActive) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(110 + Math.random() * 55, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.02, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 2);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 2);
    }, 1500);
}

function move(dir) {
    playDeepMusic();
    const s = 4;
    if(dir=='U') sub.vy = -s; if(dir=='D') sub.vy = s;
    if(dir=='L') sub.vx = -s; if(dir=='R') sub.vx = s;
}
function stop() { sub.vx = 0; sub.vy = 0; }

function spawn() {
    if(Math.random() < 0.02) divers.push({x: Math.random()*380, y: 520, type: 'diver'});
    if(Math.random() < 0.03) enemies.push({x: 420, y: 200 + Math.random()*300, s: 2 + Math.random()*3});
}

function update() {
    if(!gameActive) return;
    sub.x += sub.vx; sub.y += sub.vy;
    oxygen -= 0.1;
    oxEl.style.width = oxygen + "%";

    if(oxygen <= 0) endGame("OUT OF OXYGEN!");
    if(sub.x < 0 || sub.x > 360 || sub.y < 0 || sub.y > 475) sub.x = Math.max(0, Math.min(360, sub.x)), sub.y = Math.max(0, Math.min(475, sub.y));

    divers.forEach((d, i) => {
        d.y -= 1; // Suv oqimi bilan yuqoriga chiqish
        if(Math.abs(sub.x - d.x) < 30 && Math.abs(sub.y - d.y) < 30) {
            divers.splice(i, 1); score += 10; scoreEl.innerText = score; oxygen = Math.min(100, oxygen + 20);
        }
    });

    enemies.forEach((e, i) => {
        e.x -= e.s;
        if(Math.abs(sub.x - e.x) < 25 && Math.abs(sub.y - e.y) < 25) endGame("COLLIDED WITH SHARK!");
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Suvosti kemasi (Submarine)
    ctx.fillStyle = "#e9d8a6";
    ctx.beginPath(); ctx.roundRect(sub.x, sub.y, sub.w, sub.h, 10); ctx.fill();
    ctx.fillStyle = "#00f3ff"; ctx.fillRect(sub.x + 25, sub.y + 5, 10, 10); // Oyna

    // G'avvoslar (Divers)
    ctx.fillStyle = "#ee9b00";
    divers.forEach(d => { ctx.beginPath(); ctx.arc(d.x, d.y, 8, 0, 7); ctx.fill(); });

    // Akulalar (Enemies)
    ctx.fillStyle = "#ae2012";
    enemies.forEach(e => {
        ctx.beginPath(); ctx.moveTo(e.x, e.y); ctx.lineTo(e.x+20, e.y-10); ctx.lineTo(e.x+20, e.y+10); ctx.fill();
    });

    update();
    spawn();
    requestAnimationFrame(draw);
}

function endGame(msg) {
    gameActive = false;
    alert(msg + "\nFinal Score: " + score);
    location.reload();
}

draw();
</script>
</body>
</html>